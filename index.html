<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vaud promotion</title>
    <style>
      * {
        position: relative;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      #content-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: 100vh;
      }
      #canvas-container {
        width: 90%;
        height: 90%;
        margin-left: 0 auto;
        margin-right: 0 auto;
      }
    </style>
  </head>
  <body>
    <div id="content-wrapper">
      <div id="canvas-container">
        <canvas id="radar-canvas" width="400" height="400"></canvas>
      </div>
    </div>
  </body>
</html>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
<script>
  window.addEventListener("load", function () {
    console.log("WINDOW LOAD EVENT");

    let labels = [
      "Expérience client",
      ["Innovation des produits", "et des services"],
      "Stratégie",
      "Organisation",
      ["Digitalisation des ", "processus"],
      "Collaboration",
      ["Technologie de ", "l’information"],
      "Culture et expertise",
      ["Gestion de ", "la transformation"],
    ];

    let datasets = makeDatasets(data);

    console.log(datasets);

    let ctx = document.getElementById("radar-canvas").getContext("2d");

    let config = {
      type: "radar",
      data: {
        labels: labels,
        datasets: datasets,
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        elements: {
          point: {
            radius: 2,
          },
          line: {
            borderWidth: 1,
          },
        },
        scales: {
          r: {
            pointLabels: {
              font: {
                size: 15,
              },
            },
          },
        },
        scale: {
          ticks: {
            min: 0,
            max: 20,
            beginAtZero: true,
            stepSize: 1,
            fontSize: 30,
          },
        },
        plugins: {
          legend: {
            position: "top",
            align: "start",
            labels: {
              usePointStyle: true,
              pointStyle: "circle",
              boxWidth: 6,
              font: {
                size: 16,
              },
            },
          },
        },
      },
    };

    let chart = new Chart(ctx, config);
  });

  const DEFAULT_COLORS = ["#2F80ED", "#9B51E0", "#828282", "#f53794", "#537bc4", "#acc236", "#166a8f", "#00a950", "#58595b", "#8549ba", "#f67019"];

  let data = [
    {
      id: 1,
      num: 6,
      CX: 3,
      PI: 2.67,
      ST: 3,
      OR: 3,
      PD: 2,
      CO: 2,
      CU: 2.67,
      IT: 1,
      TM: 2,
    },
    {
      id: 2,
      num: 2,
      CX: 2.67,
      PI: 4,
      ST: 3.5,
      OR: 3.67,
      PD: 3,
      CO: 3.33,
      CU: 3.33,
      IT: 3,
      TM: 2.33,
    },
    {
      id: 3,
      num: 11,
      CX: 2,
      PI: 2,
      ST: 2,
      OR: 2.33,
      PD: 1.67,
      CO: 1.67,
      CU: 2.33,
      IT: 1.25,
      TM: 1.33,
    },
    {
      id: 4,
      num: 4,
      CX: 2.33,
      PI: 2.67,
      ST: 2.5,
      OR: 3.33,
      PD: 3,
      CO: 2.67,
      CU: 2.33,
      IT: 2.75,
      TM: 3,
    },
    {
      id: 5,
      num: 1,
      CX: 5,
      PI: 4.33,
      ST: 4.5,
      OR: 4,
      PD: 4.33,
      CO: 2.33,
      CU: 4,
      IT: 3.5,
      TM: 4.67,
    },
    {
      id: 6,
      num: 10,
      CX: 3,
      PI: 2.67,
      ST: 2,
      OR: 1.67,
      PD: 2,
      CO: 2.33,
      CU: 3,
      IT: 1.5,
      TM: 1.33,
    },
    {
      id: 7,
      num: 3,
      CX: 3.33,
      PI: 3,
      ST: 4.5,
      OR: 3,
      PD: 2,
      CO: 2.33,
      CU: 3,
      IT: 2,
      TM: 2.67,
    },
    {
      id: 8,
      num: 7,
      CX: 2.67,
      PI: 2.67,
      ST: 2,
      OR: 2.33,
      PD: 2,
      CO: 2.67,
      CU: 2.67,
      IT: 2.25,
      TM: 2,
    },
    {
      id: 9,
      num: 8,
      CX: 2.33,
      PI: 2.33,
      ST: 2.5,
      OR: 3.33,
      PD: 2,
      CO: 2.33,
      CU: 2.67,
      IT: 2,
      TM: 1.67,
    },
    {
      id: 10,
      num: 9,
      CX: 2.67,
      PI: 2.33,
      ST: 2.5,
      OR: 2.33,
      PD: 1.67,
      CO: 2,
      CU: 2.67,
      IT: 1.5,
      TM: 2.33,
    },
    {
      id: 11,
      num: 5,
      CX: 2.67,
      PI: 2.33,
      ST: 2.5,
      OR: 2,
      PD: 3.33,
      CO: 2.67,
      CU: 2.67,
      IT: 1.25,
      TM: 2,
    },
  ];

  function toChartArrays(datas) {
    let values = [];
    let labels = [];
    for (let data of datas) {
      values.push([data.CX, data.PI, data.ST, data.OR, data.PD, data.CO, data.CU, data.IT, data.TM]);
      labels.push(data.num);
    }
    return { values: values, labels: labels };
  }

  function hexToRGB(hex, alpha) {
    var r = parseInt(hex.slice(1, 3), 16),
      g = parseInt(hex.slice(3, 5), 16),
      b = parseInt(hex.slice(5, 7), 16);

    if (alpha) {
      return "rgba(" + r + ", " + g + ", " + b + ", " + alpha + ")";
    } else {
      return "rgb(" + r + ", " + g + ", " + b + ")";
    }
  }

  function makeDatasets(datas) {
    let datasets = [];
    let sets = toChartArrays(datas);
    let values = sets.values;
    let labels = sets.labels;

    for (let i = 0; i < values.length; i++) {
      let color = DEFAULT_COLORS[i % DEFAULT_COLORS.length];

      let dataset = {
        backgroundColor: hexToRGB(color, 0.1),
        pointBackgroundColor: color,
        borderColor: color,
        label: labels[i],
        data: values[i],
        fill: true,
      };

      datasets.push(dataset);
    }
    return datasets;
  }
</script>
